
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.13">
    
    
      
        <title>Home version1 - Practical Haplotype Graph Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#practical-haplotype-graph-phg" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Practical Haplotype Graph Documentation" class="md-header__button md-logo" aria-label="Practical Haplotype Graph Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Practical Haplotype Graph Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home version1
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Home_variantsInGVCFFiles/" class="md-tabs__link">
        Getting Started
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../UserInstructions/ImputeWithPHG_extractPangenome/" class="md-tabs__link">
        FAQ
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="https://javadoc.io/doc/net.maizegenetics/phg/latest/index.html" class="md-tabs__link">
      API Reference
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../getting-help/" class="md-tabs__link">
        Where to Ask Questions
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Practical Haplotype Graph Documentation" class="md-nav__button md-logo" aria-label="Practical Haplotype Graph Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Practical Haplotype Graph Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://maizegenetics.net" class="md-nav__link">
        Buckler Lab Website
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Home_variantsInGVCFFiles/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/CreatePHG_step1CreateDB_loadRef/" class="md-nav__link">
        Step 1: Create Initial PHG with Reference Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/CreatePHG_step2AssemblyAndWGSHaplotypes/" class="md-nav__link">
        Step 2: Add Haplotypes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/ImputeWithPHG_main/" class="md-nav__link">
        Step 3: Impute Variants or Haplotypes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          FAQ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          FAQ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/ImputeWithPHG_extractPangenome/" class="md-nav__link">
        Extract a Pangenome FASTA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/FindLikelyParents/" class="md-nav__link">
        Find Likely Parents for Imputation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/ImputePHG_Simple/" class="md-nav__link">
        PHG Path from a FASTQ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/ImputeWithPHG_VCF/" class="md-nav__link">
        Impute Variants from a VCF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/ImputeWithPHG_fastq-heterozygous/" class="md-nav__link">
        Impute Variants from a FASTQ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/ImputeWithPHG_fastq-homozygous/" class="md-nav__link">
        Impute Variants from a FASTQ (Homozygous)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../UserInstructions/UpdatePHGSchema/" class="md-nav__link">
        Update Existing PHG Database to Latest Schema
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://javadoc.io/doc/net.maizegenetics/phg/latest/index.html" class="md-nav__link">
        API Reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Where to Ask Questions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Where to Ask Questions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../getting-help/" class="md-nav__link">
        Biostars
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#phg-docker-pipeline" class="md-nav__link">
    PHG Docker Pipeline
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phg-application-programming-interface-api" class="md-nav__link">
    PHG Application Programming Interface (API)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phg-database-schema" class="md-nav__link">
    PHG Database Schema
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phg-database-support" class="md-nav__link">
    PHG Database Support
  </a>
  
    <nav class="md-nav" aria-label="PHG Database Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phg-postgres-docker" class="md-nav__link">
    PHG Postgres Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phg-database-migration" class="md-nav__link">
    PHG Database Migration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phg-docker-instances" class="md-nav__link">
    PHG Docker Instances
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-pipeline-phase-1-details" class="md-nav__link">
    Docker Pipeline Phase 1 Details
  </a>
  
    <nav class="md-nav" aria-label="Docker Pipeline Phase 1 Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#loadgenomeintervalssh" class="md-nav__link">
    LoadGenomeIntervals.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loadassemblyanchorssh" class="md-nav__link">
    LoadAssemblyAnchors.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallelassemblyanchorsloadsh" class="md-nav__link">
    ParallelAssemblyAnchorsLoad.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#createhaplotypes" class="md-nav__link">
    CreateHaplotypes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#createconsensish" class="md-nav__link">
    CreateConsensi.sh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-pipeline-phase-2-details" class="md-nav__link">
    Docker Pipeline Phase 2 Details
  </a>
  
    <nav class="md-nav" aria-label="Docker Pipeline Phase 2 Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#indexpangenomesh" class="md-nav__link">
    IndexPangenome.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#findpathminimap2sh" class="md-nav__link">
    FindPathMinimap2.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exportpathsh" class="md-nav__link">
    ExportPath.sh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<p><img alt="PHGlogo.png" src="../images_version1/PHGlogo.png" /></p>
<h1 id="practical-haplotype-graph-phg"><a href="https://drive.google.com/open?id=1oavzrgqaA_FWKK077uAVQdDgGb683W_y">Practical Haplotype Graph (PHG)</a></h1>
<p>With improved sequencing technology, sequencing costs are declining very rapidly. But bioinformatics challenges for processing data and inferring genotypes have increased. To address this, we have developed a general, graph-based, computational framework called the Practical Haplotype Graph (PHG), that can be used with a variety of skim sequencing methods to infer high-density genotypes directly from low-coverage sequence. The idea behind the PHG is that in a given breeding program, all parental genotypes can be sequenced at high coverage, and loaded as parental haplotypes in a <a href="https://drive.google.com/open?id=1ZmxJ1gD7iqFf5205WXA7qnt3efKbQ2RY">relational database</a>. Progeny can then be sequenced at low coverage and used to infer which parental haplotypes/genotypes from the database are most likely present in a given progeny.   </p>
<p>Practical Haplotype Graph: 
The PHG is a trellis <a href="https://drive.google.com/open?id=1NChUJd3ab9nr2lxCWankwNRpPaazr7A_">graph</a> based representation of genic and intergenic regions (called <a href="https://drive.google.com/open?id=13CZTN9yHsvlwJFTMnLQPJpZemEh3Tsn-">reference ranges</a>) which represent diversity across and between taxa.  It can be used to: create custom genomes for alignment, call rare alleles, impute genotypes, and efficiently store genomic data from many lines (i.e. <a href="https://drive.google.com/open?id=1-dxLMY6oMbedoh-bztywtxhSGnT6SnuB">reference</a>, <a href="https://drive.google.com/open?id=1Ffk3rKy0XmwE2MMYr0rtg3qRKqell9XP">assemblies</a>, and <a href="https://drive.google.com/open?id=1jv1lfPQViQrmbu9FL7mEaGsXIZPTRkWW">other lines</a>). <a href="https://drive.google.com/open?id=1CtxBo41GnmPyg3z_AgQWa8626857gFeZ">Skim sequences</a> generated for a given taxon are aligned to <a href="https://drive.google.com/open?id=1HGr0h-1VIQzWJO0pO57FNmBpZRy4xcPP">consensus sequences</a> in the PHG to identify the haplotype node at a given anchor. All the anchors for a given taxon are processed through a Hidden Markov Model (HMM) to identify the <a href="https://drive.google.com/open?id=1EZl5C9UMIkPvvWi7GdDrqe0PpQnsmkZl">most likely path</a> through the graph. Path information is used to identify the variants (SNPs). Low cost sequencing technologies, coupled with the PHG, facilitate the genotyping of large number of samples to increase the size of training populations for genomic selection models. This can in turn increase predictive accuracy and selection intensity in a breeding program.</p>
<p>A more detailed introduction can be seen in Peter Bradbury's <a href="../Pipeline_version1/PAG_Bradbury_PHG_ver3.pdf">PHG presentation slides</a> from the 2018 Plant and Animal Genome conference (PAG).</p>
<p>View also the <a href="../Pipeline_version1/Poster_PAG2018_PR.pdf">2018 PAG poster</a>.</p>
<h2 id="phg-docker-pipeline"><em>PHG Docker Pipeline</em></h2>
<p><a href="../images_version1/PopulatePHGDatabaseLarge.png"><img alt="PopulatePHGDatabase.png" src="../images_version1/PopulatePHGDatabase.png" /></a>
<a href="../images_version1/GenotypeUsingPHGLarge.png"><img alt="GenotypeUsingPHG.png" src="../images_version1/GenotypeUsingPHG.png" /></a></p>
<h2 id="phg-application-programming-interface-api"><em>PHG Application Programming Interface (API)</em></h2>
<p><a href="https://javadoc.io/doc/net.maizegenetics/phg/latest/index.html">API Documentation</a></p>
<p><a href="../images_version1/PHGAPILarge.png"><img alt="PHGAPI.png" src="../images_version1/PHGAPI.png" /></a></p>
<h2 id="phg-database-schema"><em>PHG Database Schema</em></h2>
<p><a href="../images_version1/PHGSchemaLarge.png"><img alt="PHGSchema.png" src="../images_version1/PHGSchema.png" /></a></p>
<h2 id="phg-database-support"><em>PHG Database Support</em></h2>
<p>The PHG pipeline currently supports SQLite and postgres databases outside of a docker, as well as postgres database inside a docker. Our intent is for users to migrate to the dockerized postgres database.</p>
<p>Access to PHG databases in all cases is through a config file that specifies the host:port, user,  password, db name, and the database type (sqlite or postgres).  An example of an SQLite config file is below. NOTE: The user and password parameters are not used for SQLite.  The sqlite db file must include a path that is relative to it's location within the PHG docker scripts. This will be discussed when each script is discussed.</p>
<pre><code>#!python

host=localHost
user=sqlite
password=sqlite
DB=/tempFileDir/outputDir/phgTestDB_mapq48.db
DBtype=sqlite
</code></pre>
<p>An example of a postgres config file is below:</p>
<pre><code>#!python

host=199.17.0.7:5432
user=postgres
password=postgresPWD
DB=phgdb
DBtype=postgres
</code></pre>
<h3 id="phg-postgres-docker"><a href="Pipeline_version1/PHG_PostgresDocker">PHG Postgres Docker</a></h3>
<h3 id="phg-database-migration"><a href="Pipeline_version1/PHG_Liquibase">PHG Database Migration</a></h3>
<h2 id="phg-docker-instances"><em>PHG Docker Instances</em></h2>
<p>The PHG is deployed as a Docker image.  Docker is an open source platform that wraps applications into an image to be deployed on a host system.  Docker containers are instances of a Docker image that may run simultaneously on the same host.  See the Docker documentation <a href="https://docs.docker.com">here</a> for details.</p>
<p>The PHG Docker image is built on the GATK image from <a href="https://hub.docker.com">docker hub</a>.  To this image the following analysis tools are added:  VIM, BWA, minimap2, jbwa, htslib, bcftools, SAMTools and TASSEL-5 with the PHG jar.  In addition, scripts for loading and processing the PHG are added. </p>
<p>To pull the PHG images from docker hub, run the following commands (the second pull is only necessary if you are pulling a new PHG image to run against an existing database file):</p>
<pre><code>#!python

docker pull maizegenetics/phg
docker pull maize genetics/phg_liquibase

</code></pre>
<p>If on a Cornell CBSU machine, use docker1 as below:</p>
<pre><code>#!python

docker1 pull maizegenetics/phg
docker1 pull maizegenetics/phg_liquibase
</code></pre>
<p>ON cbsu:
 NOTE: If unable to pull a docker image from docker hub on a Cornell CBSU machine, check
  if you are on an enhanced security machine.  cbsumm01, 03, 11 and others are.
  You can see this if you go to basic biohpc reservations pages, and look
  at the machines you're able to reserve.  They will have a note in the description
  about enhanced security.</p>
<p>"certificate signed by unknown authority"  (see above - enhanced security machine)</p>
<p><a href="../images_version1/PHGDockerDiagramLarge.png"><img alt="PHG_Docker_Diagram.png" src="../images_version1/PHG_Docker9pt.png" /></a></p>
<h2 id="docker-pipeline-phase-1-details"><em>Docker Pipeline Phase 1 Details</em></h2>
<p>Phase 1 of the pipeline is concerned with populating the database with reference, assembly (optional) and haplotype sequence data.  In addition, consensus anchor sequences are determined from those haplotype sequences currently in the database.  To create the data for each of these steps there is a shell script provided within the Docker image. These scripts live at the root directory in the Docker linux tree.   The functionality performed in each script is defined below.  </p>
<p>These scripts may be run from within a Docker container or on the command line that creates the docker container.  The description of each script includes an example Docker command that creates a container and runs the specified script.</p>
<p>The first step is to create reference intervals to be used in the pipeline.  The reference intervals are generally conserved regions identified from your reference genome.  They may be based on any algorithm you choose.  Sometimes it is the gene regions from gff files, but could be exon or any other regions, or even something arbitary, e.g. every 1000 bps of the reference genome.  Any region not specified in the reference intervals file will be considered as an inter-genic (or non-conserved) region.</p>
<p>The output required is a tab-delimited file in bedfile format (positions are 0-based, start position is inclusive, end position is exclusive), containing columns for "chr", "startpos" and "endpos" as the first 3 columns.  Other columnns and data may be present but will be ignored.  Headerlines must begin with # and will be skipped.  </p>
<p>After successfully creating the reference intervals file the LoadGenomeIntervals.sh script must be run to create the initial database with reference intervals and haplotypes for the reference genome.</p>
<h3 id="loadgenomeintervalssh"><a href="Pipeline_version1/LoadGenomeIntervals">LoadGenomeIntervals.sh</a></h3>
<p>The following pipeline steps may be run or skipped, depending on your intended use of the PHG database.  See the individual wiki pages for details.</p>
<h3 id="loadassemblyanchorssh"><a href="Pipeline_version1/LoadAssemblyAnchors">LoadAssemblyAnchors.sh</a></h3>
<h3 id="parallelassemblyanchorsloadsh"><a href="Pipeline_version1/ParallelAssemblyAnchorsLoad">ParallelAssemblyAnchorsLoad.sh</a></h3>
<h3 id="createhaplotypes"><a href="Pipeline_version1/CreateHaplotypes">CreateHaplotypes</a></h3>
<h3 id="createconsensish"><a href="Pipeline_version1/CreateConsensi">CreateConsensi.sh</a></h3>
<h2 id="docker-pipeline-phase-2-details"><em>Docker Pipeline Phase 2 Details</em></h2>
<p>Phase 2 of the pipeline uses the stored haplotype graph data to infer genotypes from skim sequences and is split into 2 sub-phases. A path through the graph may be determined based on specific haplotype nodes or based on consensus sequences.  Once a path is determined, it is stored in the database paths table.  The haplotype node ids from the haplotypes table that comprise the path are exported to a file.  The paths can then be used to export a VCF file containing the Genotyped SNPs for the taxon processed.</p>
<p>The Two sub phases are as follows.</p>
<ul>
<li>
<p>The first phase(Phase 2a) simply extracts the haplotypes from the DB and writes a pangenome fasta file.  Then the Fasta File is indexed using minimap2. <strong>This step only needs to be executed once</strong></p>
</li>
<li>
<p>Phase 2b then takes this index file and aligns reads using FindPathMinimap2.sh then can export the Path to a VCF using ExportPath.sh</p>
</li>
</ul>
<p>The shell scripts to find and export the paths are located in the root directory of the Docker image.  These scripts are described below. </p>
<p>As with the Phase 1 pipeline, these scripts may be run from within a Docker container or on the command line that creates the docker container.  The description of each script includes an example Docker command that creates a container and runs the specified script.</p>
<h3 id="indexpangenomesh"><a href="Pipeline_version1/IndexPangenome">IndexPangenome.sh</a></h3>
<h3 id="findpathminimap2sh"><a href="Pipeline_version1/FindPathMinimap2">FindPathMinimap2.sh</a></h3>
<h3 id="exportpathsh"><a href="Pipeline_version1/ExportPath">ExportPath.sh</a></h3>
<h1 id="how-to-ask-for-help-and-report-bugs">How to ask for help and report bugs</h1>
<h2 id="asking-questions">Asking questions</h2>
<p>Please use Biostars to ask for help. Instructions for using Biostars are <a href="../Pipeline_version1/help_biostars/">here</a></p>
<h3 id="phg-workshop-june-4-8-2018-cornell-university-ithaca">PHG Workshop (June 4-8, 2018): Cornell University - Ithaca</h3>
<p><a href="https://drive.google.com/file/d/1G7h1eqc_LZ7OV0FU3oOANTYsXyZVij9t/view?usp=sharing">Agenda</a></p>
<p><a href="https://drive.google.com/drive/folders/1egsVyumoZLVkbSdv2TBelKPfID122fcT?usp=sharing">Presentations</a></p>
<h3 id="phg-workshop-august-17-18-2018-irri-philippines">PHG Workshop (August 17-18, 2018): IRRI - Philippines</h3>
<p><a href="https://drive.google.com/file/d/10YIeHtHE0v4EdCg9U1mbhvcT4W6pXL5M/view?usp=sharing">Agenda</a></p>
<p><a href="https://drive.google.com/drive/folders/1rnN1TtjRKvLITvvFDJL7dD0WMSpcIgPQ?usp=sharing">Presentations</a></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight", "search.share"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>